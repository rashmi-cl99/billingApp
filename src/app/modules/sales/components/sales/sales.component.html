<ng-template #norecord>
  <div>
    No Record found
  </div>
</ng-template>
<div
  class="d-flex flex-row flex-wrap px-0 col-lg-11 col-12 mx-auto justify-content-between align-items-center py-5"
>
  <div class="col-lg-4 col-12">
    <h1 class="my-0">Record sales data</h1>
  </div>

  <div
    class="col-lg-8 col-12 mt-3 d-flex flex-row flex-wrap align-items-center justify-content-lg-end justify-content-start"
  >
    <mat-form-field class="mx-2">
      <mat-label>Choose Store</mat-label>
      <mat-select name="shopSelected" [(ngModel)]="shopSelected">
        <mat-option
          *ngFor="let shop of shops"
          [value]="shop.id"
          class="robot-regular headertxt"
        >
          {{ shop.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="mx-2">
      <input
        name="dateSelected"
        matInput
        [matDatepicker]="dp3"
        placeholder="Choose Date"
        disabled
        [(ngModel)]="dateSelected"
        [max]="maxDate"
      />
      <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
      <mat-datepicker #dp3 disabled="false"></mat-datepicker>
    </mat-form-field>
    <div>
      <button
        mat-raised-button
        color="primary"
        [disabled]="shopSelected === null || dateSelected === null"
        (click)="onClickGetCategory()"
        class="btn text-white"
      >
        SUBMIT
      </button>
    </div>
  </div>
</div>

<div class="d-flex flex-row flex-wrap px-0 col-lg-11 col-12 mx-auto ">
  <div class="col-lg-2 col-md-3 col-12">
    <p class="bg-dark-grey my-0 py-3 px-3 robot-regular headertxt main-th-bg">
      Choose category
    </p>
    <div class="bg-white" style="min-height: 300px">
      <!-- <p class="text-center my-0 pt-3" *ngIf="categoriesData.length === 0">No Categories Found</p> -->
      <p class="text-center my-0 pt-3" *ngIf="categoriesData.length === 0">
        (Choose Shop)
      </p>

      <div
        [ngClass]="{
          theadbg: category.id === categorySelected
        }"
        class="d-flex flex-row flex-wrap p-3 cursor-pointer"
        *ngFor="let category of categoriesData"
        (click)="onClickCategory(category.id)"
      >
        <input
          type="checkbox"
          [disabled]="true"
          [checked]="category.is_completed"
          class="form-check-input "
          [id]="category.id"
        />
        <label
          [ngClass]="{
            'font-weight-bold': category.id === categorySelected
          }"
          class="form-check-label robot-regular headertxt"
          [for]="category.id"
          >{{ category.name }}</label
        >
        <span
          [ngClass]="{
            'font-weight-bold': category.id === categorySelected
          }"
          class="ml-auto px-3  robot-regular font-sm headertxt"
          >{{ category.count }}</span
        >
      </div>
    </div>
  </div>
  <div class=" col-lg-10 col-md-9 col-12">
    <p class="bg-dark-grey my-0 py-3 px-3 robot-regular headertxt main-th-bg">
      Enter sales data
    </p>
    <table mat-table [dataSource]="dataSource" class=" mat-elevation-z8 w-100">
      <tr ng-form="myForm">
        <ng-container matColumnDef="id">
          <th
            class="px-3 robot-bold thtext theadbg"
            mat-header-cell
            *matHeaderCellDef
            [attr.rowspan]="2"
          >
            ID
          </th>

          <td
            mat-cell
            *matCellDef="let element"
            class=" font-sm robot-regular headertxt tdcolor"
          >
            {{ element.index }}.
          </td>
        </ng-container>
        <!-- Itemdesc Column -->
        <ng-container matColumnDef="itemdescription">
          <th
            mat-header-cell
            *matHeaderCellDef
            [attr.rowspan]="2"
            class="robot-bold thtext theadbg"
          >
            ITEM DESCRIPTION
          </th>

          <td
            mat-cell
            *matCellDef="let element"
            class="align-top font-sm robot-regular headertxt tdcolor"
          >
            <div class="">
              <!-- liquor name -->
              <div class="col-12">
                <p class="my-2 ">
                  <span>{{ element.name }}</span>
                </p>
              </div>
              <!-- liquor price -->
              <p class="my-2 col-12">
                <span><b>INR:</b> {{ element.INR }}/-</span>
              </p>
              <!-- liquor opening_quantity -->
              <p class="my-2 col-12">
                <span><b>Opening Qty:</b>{{ element.opening_quantity }}</span>
              </p>
            </div>
          </td>
        </ng-container>
        <!-- sales -->
        <ng-container matColumnDef="sales">
          <th
            mat-header-cell
            *matHeaderCellDef
            class=" robot-bold thtext theadbg px-3"
          >
            SALES
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            class="align-top font-sm robot-regular headertxt tdcolor"
          >
            <ng-container
              *ngIf="
                element.id == editRowID || editRowID === null;
                else textbox
              "
            >
              <div class="col-12 my-2 d-flex flex-wrap">
                <label class="font-weight-bold">Cash:&nbsp; </label>
                <input
                  required
                  type="number"
                  class="col-12 col-lg-4 form-control pl-2"
                  matInput
                  name="input"
                  [(ngModel)]="element.cash"
                  (ngModelChange)="onChangeSalesQuantity(element)"
                  [ngClass]="{
                    'border-red': element.cash < 0 || element.cash === null
                  }"
                />
              </div>

              <div
                class="col-12 my-2  d-flex flex-wrap"
                *ngFor="let item of element.posmachine"
              >
                <span class="font-weight-bold">pos{{ item.pos }}:&nbsp;</span>
                <input
                  type="number"
                  class="col-12 col-lg-4 form-control pl-2"
                  matInput
                  name="input"
                  [(ngModel)]="item.quantity"
                  (ngModelChange)="onChangeSalesQuantity(element)"
                  [ngClass]="{
                    'border-red': item.quantity < 0 || item.quantity === null
                  }"
                />
              </div>
              <div class="col-12 my-2  d-flex flex-wrap">
                <p><b>Total:</b>&nbsp;{{ element.totalCash }}</p>
              </div>
            </ng-container>
            <ng-template #textbox>
              <p class=" col-12 my-2 d-flex  flex-wrap">
                <span class="font-weight-bold">cash:&nbsp;</span>
                <span>{{ element.cash }}</span>
              </p>
              <div
                class=" col-12 my-2 d-flex flex-row flex-wrap"
                *ngFor="let item of element.posmachine"
              >
                <span class="font-weight-bold">pos{{ item.pos }}:&nbsp;</span>
                <span>{{ item.quantity }}</span>
              </div>
              <div class="col-12 my-2  d-flex flex-wrap">
                <p><b>Total:</b>&nbsp;{{ element.totalCash }}</p>
              </div>
            </ng-template>
          </td>
        </ng-container>

        <ng-container matColumnDef="closing_quantity">
          <th
            mat-header-cell
            *matHeaderCellDef
            class=" robot-bold thtext theadbg px-3"
          >
            Closing Quantity
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            class="align-top font-sm robot-regular headertxt tdcolor"
          >
            <!-- liquor closed_quantity -->
            <p class="my-2 col-12">
              <span><b>Closed Qty:</b> {{ element.closing_quantity }}</span>
            </p>
          </td>
        </ng-container>

        <!------pos-->
        <ng-container matColumnDef="amount">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="robot-bold thtext theadbg px-3"
          >
            AMOUNT
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            class="align-top font-sm robot-regular headertxt tdcolor"
          >
            <ng-container
              *ngIf="
                element.id == editRowID || editRowID === null;
                else textbox
              "
            >
              <div class=" col-12 d-flex my-1">
                <span class="my-1 font-weight-bold">Total:&nbsp;</span>
                <span class="my-1">{{ element.total }}/-</span>
              </div>
              <div class=" col-12 d-flex my-1 flex-wrap">
                <span class="font-weight-bold">Discount(INR):&nbsp;</span>
                <input
                  type="number"
                  class="col-lg-4 col-12 form-control pl-2"
                  matInput
                  name="input"
                  [(ngModel)]="element.discount"
                  (ngModelChange)="onChangeDiscount(element)"
                  [ngClass]="{
                    'border-red':
                      element.discount < 0 || element.discount === null
                  }"
                />
              </div>
              <div class=" col-12 d-flex my-1">
                <span class="my-1 font-weight-bold">Total Amount:&nbsp;</span>
                <span class="my-1">{{ element.total_amount }}/-</span>
              </div>
            </ng-container>
            <ng-template #textbox>
              <div class=" col-12 d-flex flex-wrap">
                <p class="my-1 font-weight-bold">Total:&nbsp;</p>
                <p class="font-weight-bold my-1">INR: {{ element.total }}/-</p>
              </div>

              <div class=" col-12 d-flex flex-wrap">
                <p class="my-1 font-weight-bold">Discount&nbsp;:</p>
                <p class="font-weight-bold my-1">
                  INR: {{ element.discount }}/-
                </p>
              </div>
              <div class=" col-12 d-flex flex-wrap">
                <p class="my-1 font-weight-bold">Total Amount:&nbsp;</p>
                <p class="font-weight-bold my-1">
                  INR: {{ element.total_amount }}/-
                </p>
              </div>
            </ng-template>
          </td>
        </ng-container>

        <!-------------purchase----------->
        <ng-container matColumnDef="purchase">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="robot-bold thtext theadbg px-3"
          >
            PURCHASE
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            class=" font-sm robot-regular headertxt tdcolor"
          >
            <ng-container
              *ngIf="
                element.id == editRowID || editRowID === null;
                else textbox
              "
            >
              <div class="d-flex col-12 flex-wrap">
                <span class="font-weight-bold">Quantity:&nbsp;</span>
                <div class="col-lg-4 col-12 px-0 ">
                  <input
                    type="number"
                    class=" form-control pl-2"
                    matInput
                    name="input"
                    [ngClass]="{
                      'border-red':
                        element.purchase_quantity < 0 ||
                        element.purchase_quantity === null
                    }"
                    [(ngModel)]="element.purchase_quantity"
                  />
                  <!-- <small
                    class="text-danger"
                    *ngIf="element.purchase_quantity < 0"
                    >value > 0</small
                  > -->
                </div>
              </div>
            </ng-container>
            <ng-template #textbox>
              <div>
                <p class="my-1">
                  <span class="font-weight-bold">Quantity</span>:
                  <span class="">{{
                    element.purchase_quantity
                  }}</span>
                </p>
              </div>
            </ng-template>
          </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="robot-bold thtext theadbg px-3"
          >
            ACTIONS
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            class="font-sm robot-regular headertxt tdcolor"
          >
            <button
              *ngIf="editRowID !== null"
              color="primary"
              mat-icon-button
              [ngClass]="
                editRowID == element.id ? 'bg-dark-grey' : 'bg-dark-grey'
              "
              type="button"
              (click)="editRowID = editRowID == element.id ? '' : element.id"
              [disabled]="
                (editRowID !== '' && editRowID !== element.id) ||
                isValidLiquor(element)
              "
            >
              <mat-icon>
                {{ editRowID == element.id ? "done" : "edit" }}
              </mat-icon>
            </button>
          </td>
        </ng-container>
      </tr>
      <!-- Header row second group -->
      <!-- <ng-container matColumnDef="header-row-second-group">
          <th
            mat-header-cell
            *matHeaderCellDef
            [attr.colspan]="3"
            class="text-center"
          >
            Amount
          </th>
        </ng-container>
    
        <tr
          mat-header-row
          *matHeaderRowDef="['amount', 'header-row-second-group']"
        ></tr>-->
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      <!-- <ng-template [ngIf]="dataSource.data.length === 0">
            <tr mat-footer-row *matFooterRowDef="['noRecord']"></tr>
        </ng-template> -->
    </table>

    <div class="text-right">
      <button
        *ngIf="editRowID === null"
        mat-raised-button
        color="primary"
        (click)="submitSalesData()"
        class=" text-white mt-3"
        [disabled]="isValidTable()"
      >
        Submit Data
      </button>

      <!-- <button>
        Submit Data
      </button> -->
    </div>
  </div>
</div>
